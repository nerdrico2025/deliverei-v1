# üìò DELIVEREI v1 - Resumo T√©cnico Completo

**Projeto:** Sistema Multi-tenant de Delivery  
**Vers√£o:** 1.0  
**Data de Compila√ß√£o:** 16 de outubro de 2025  
**Reposit√≥rio:** nerdrico2025/deliverei-v1  
**Status:** ‚úÖ MVP Completo e Funcional

---

## üìë √çndice

1. [Vis√£o Geral do Sistema](#1-vis√£o-geral-do-sistema)
2. [Stack Tecnol√≥gico](#2-stack-tecnol√≥gico)
3. [Funcionalidades Implementadas](#3-funcionalidades-implementadas)
4. [Funcionalidades Planejadas (N√£o Implementadas)](#4-funcionalidades-planejadas-n√£o-implementadas)
5. [Estrutura de Arquivos e Hierarquia](#5-estrutura-de-arquivos-e-hierarquia)
6. [Modelos de Dados (Prisma Schema)](#6-modelos-de-dados-prisma-schema)
7. [Endpoints da API](#7-endpoints-da-api)
8. [Integra√ß√µes Externas](#8-integra√ß√µes-externas)
9. [Seguran√ßa e Multi-tenancy](#9-seguran√ßa-e-multi-tenancy)
10. [Otimiza√ß√µes e Performance](#10-otimiza√ß√µes-e-performance)

---

## 1. VIS√ÉO GERAL DO SISTEMA

### 1.1 Descri√ß√£o do Projeto

**DELIVEREI** √© uma plataforma SaaS completa de delivery multi-tenant que permite que m√∫ltiplos estabelecimentos comerciais (restaurantes, lanchonetes, pizzarias, etc.) operem suas lojas virtuais de forma independente e isolada dentro de uma √∫nica infraestrutura compartilhada.

### 1.2 Prop√≥sito e Objetivos

**Objetivos Principais:**
- Fornecer uma solu√ß√£o completa de delivery para pequenos e m√©dios estabelecimentos
- Garantir isolamento completo de dados entre diferentes empresas (multi-tenancy seguro)
- Oferecer interface administrativa intuitiva para gest√£o de produtos, pedidos e clientes
- Proporcionar experi√™ncia de compra otimizada para clientes finais
- Suportar m√∫ltiplos m√©todos de pagamento (PIX, Cart√£o, Boleto)
- Facilitar comunica√ß√£o com clientes via WhatsApp e notifica√ß√µes

**P√∫blico-alvo:**
- **Empresas:** Restaurantes, pizzarias, lanchonetes, cafeterias
- **Clientes Finais:** Consumidores que desejam fazer pedidos online
- **Administradores:** Gestores de estabelecimentos comerciais
- **Super Admins:** Equipe de gest√£o da plataforma DELIVEREI

### 1.3 Arquitetura Geral

**Modelo de Arquitetura:** Monorepo Full-stack

```
deliverei-v1/
‚îú‚îÄ‚îÄ backend/          # API REST em NestJS
‚îÇ   ‚îú‚îÄ‚îÄ src/          # C√≥digo-fonte do backend
‚îÇ   ‚îú‚îÄ‚îÄ prisma/       # Schema e migrations do banco
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ src/              # Frontend em React
‚îÇ   ‚îú‚îÄ‚îÄ components/   # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ pages/        # P√°ginas da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ services/     # Servi√ßos de API
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ docs/             # Documenta√ß√£o
```

**Padr√£o Arquitetural:**
- **Backend:** Arquitetura modular baseada em NestJS com separa√ß√£o de concerns (Controllers, Services, DTOs, Guards, Middlewares)
- **Frontend:** Arquitetura baseada em componentes React com Context API para gerenciamento de estado
- **Banco de Dados:** PostgreSQL gerenciado pelo Supabase com ORM Prisma
- **Autentica√ß√£o:** JWT stateless com refresh tokens
- **Multi-tenancy:** Isolamento por empresaId com middleware de tenant resolution

---

## 2. STACK TECNOL√ìGICO

### 2.1 Backend

#### Core Framework e Runtime
- **NestJS** 10.3.0 - Framework Node.js progressivo baseado em TypeScript
- **Node.js** 20+ - Runtime JavaScript
- **TypeScript** 5.3.3 - Superset tipado de JavaScript

#### Banco de Dados e ORM
- **PostgreSQL** - Banco de dados relacional (via Supabase)
- **Prisma** 5.8.0 - ORM moderno com type-safety
- **Supabase** - Plataforma de banco de dados gerenciado

#### Autentica√ß√£o e Seguran√ßa
- **Passport** 0.7.0 - Middleware de autentica√ß√£o
- **Passport-JWT** 4.0.1 - Estrat√©gia JWT para Passport
- **Passport-Local** 1.0.0 - Estrat√©gia local para Passport
- **bcrypt** 5.1.1 - Hash de senhas
- **@nestjs/jwt** 10.2.0 - M√≥dulo JWT do NestJS

#### Valida√ß√£o e Transforma√ß√£o
- **class-validator** 0.14.1 - Decorators de valida√ß√£o
- **class-transformer** 0.5.1 - Transforma√ß√£o de objetos

#### Integra√ß√µes Externas
- **Stripe** 19.1.0 - Gateway de pagamento (assinaturas)
- **Axios** 1.12.2 - Cliente HTTP
- **@nestjs/axios** 4.0.1 - M√≥dulo Axios do NestJS

#### Cache e Performance
- **Redis** 4.6.12 - Cache in-memory e gerenciamento de sess√µes

#### Documenta√ß√£o
- **@nestjs/swagger** 7.4.2 - Documenta√ß√£o autom√°tica de API
- **swagger-ui-express** 5.0.1 - UI do Swagger

#### Utilit√°rios
- **uuid** 9.0.1 - Gera√ß√£o de UUIDs
- **rimraf** 5.0.5 - Limpeza de diret√≥rios
- **rxjs** 7.8.1 - Programa√ß√£o reativa

### 2.2 Frontend

#### Core Framework
- **React** 18.3.1 - Biblioteca para interfaces de usu√°rio
- **React DOM** 18.3.1 - Renderiza√ß√£o DOM para React
- **TypeScript** 5.5.3 - Superset tipado de JavaScript

#### Build Tool
- **Vite** 5.4.2 - Build tool moderno e r√°pido
- **@vitejs/plugin-react** 4.3.1 - Plugin React para Vite

#### Roteamento
- **React Router DOM** 7.9.3 - Roteamento declarativo

#### Estiliza√ß√£o
- **Tailwind CSS** 3.4.1 - Framework CSS utility-first
- **PostCSS** 8.4.35 - Processador CSS
- **Autoprefixer** 10.4.18 - Plugin PostCSS para prefixos vendor

#### Comunica√ß√£o com API
- **Axios** 1.12.2 - Cliente HTTP
- **@supabase/supabase-js** 2.57.4 - Cliente Supabase

#### Visualiza√ß√£o de Dados
- **Recharts** 3.2.1 - Biblioteca de gr√°ficos React

#### Gerenciamento de Pagamentos
- **@stripe/react-stripe-js** 5.2.0 - Componentes React para Stripe
- **@stripe/stripe-js** 8.0.0 - Cliente JavaScript Stripe

#### Utilit√°rios
- **date-fns** 4.1.0 - Manipula√ß√£o de datas
- **lucide-react** 0.344.0 - √çcones React
- **react-helmet-async** 2.0.5 - Gerenciamento de head da p√°gina
- **react-qr-code** 2.0.18 - Gera√ß√£o de QR codes

#### Qualidade de C√≥digo
- **ESLint** 9.9.1 - Linter JavaScript/TypeScript
- **typescript-eslint** 8.3.0 - Parser e plugin ESLint para TypeScript

#### Otimiza√ß√£o
- **Terser** 5.44.0 - Minificador JavaScript

### 2.3 Infraestrutura

#### Hospedagem e Deploy
- **Render** - Plataforma de hospedagem cloud
  - Backend API hospedado como Web Service
  - PostgreSQL gerenciado via Render
  
- **Supabase** - Backend-as-a-Service
  - PostgreSQL database hosting
  - Connection pooling
  - Autentica√ß√£o (n√£o utilizada atualmente)

#### Containeriza√ß√£o (Desenvolvimento)
- **Docker** - Containeriza√ß√£o de aplica√ß√µes
- **Docker Compose** - Orquestra√ß√£o de containers (Redis)

#### Controle de Vers√£o
- **Git** - Sistema de controle de vers√£o
- **GitHub** - Hospedagem de reposit√≥rio e CI/CD

---

## 3. FUNCIONALIDADES IMPLEMENTADAS

### 3.1 Autentica√ß√£o e Autoriza√ß√£o

#### Recursos Implementados
- ‚úÖ Sistema de login com email e senha
- ‚úÖ Cadastro de novos usu√°rios (signup)
- ‚úÖ Sistema de JWT com access token (15min) e refresh token (7 dias)
- ‚úÖ Renova√ß√£o autom√°tica de tokens (refresh)
- ‚úÖ Logout com invalida√ß√£o de refresh token
- ‚úÖ Cria√ß√£o de conta a partir de pedido (checkout sem cadastro pr√©vio)

#### N√≠veis de Acesso (Roles)
- **SUPER_ADMIN:** Acesso total ao sistema, gest√£o de empresas e assinaturas
- **ADMIN_EMPRESA:** Acesso √† administra√ß√£o da pr√≥pria empresa
- **CLIENTE:** Acesso √† vitrine e funcionalidades de compra

#### Endpoints
```
POST /auth/login                     - Login
POST /auth/signup                    - Cadastro
POST /auth/refresh                   - Renovar token
POST /auth/logout                    - Logout
POST /auth/create-account-from-order - Criar conta via checkout
```

### 3.2 Multi-tenancy (Empresas)

#### Recursos Implementados
- ‚úÖ Isolamento completo de dados por empresaId
- ‚úÖ Tenant Middleware para extra√ß√£o de tenant via:
  - Subdom√≠nio (ex: `pizza-express.deliverei.com.br`)
  - Slug na URL (ex: `/public/pizza-express`)
- ‚úÖ Valida√ß√£o de tenant em todas as opera√ß√µes
- ‚úÖ Decorator @CurrentEmpresa() para injetar empresa atual
- ‚úÖ CRUD completo de empresas (SuperAdmin)

#### Modelo Empresa
```typescript
{
  id: string
  nome: string
  slug: string (√∫nico)
  subdominio: string (√∫nico)
  ativo: boolean
  whatsappNumero: string?
  whatsappToken: string?
  asaasCustomerId: string?
}
```

#### Endpoints
```
GET    /empresas           - Listar empresas (SuperAdmin)
POST   /empresas           - Criar empresa (SuperAdmin)
GET    /empresas/:id       - Buscar empresa (SuperAdmin)
PATCH  /empresas/:id       - Atualizar empresa (SuperAdmin)
DELETE /empresas/:id       - Remover empresa (SuperAdmin)
```

### 3.3 Gest√£o de Produtos

#### Recursos Implementados
- ‚úÖ CRUD completo de produtos
- ‚úÖ Listagem com pagina√ß√£o, busca e filtros
- ‚úÖ Upload de imagens (via URL)
- ‚úÖ Controle de estoque
- ‚úÖ Categoriza√ß√£o de produtos
- ‚úÖ Soft delete (produtos inativos)
- ‚úÖ Hard delete (SUPER_ADMIN apenas)
- ‚úÖ Badges de status (lowStock, outOfStock)

#### Modelo Produto
```typescript
{
  id: string
  nome: string
  descricao: string?
  preco: Decimal
  imagem: string?
  ativo: boolean
  empresaId: string
  estoque: int
  categoria: string?
}
```

#### Endpoints Administrativos
```
GET    /produtos           - Listar produtos da empresa
POST   /produtos           - Criar produto
GET    /produtos/:id       - Buscar produto
PATCH  /produtos/:id       - Atualizar produto
DELETE /produtos/:id       - Soft delete
DELETE /produtos/:id/hard  - Hard delete (SuperAdmin)
```

#### Endpoints P√∫blicos
```
GET /public/:slug/produtos           - Produtos da loja
GET /public/:slug/produtos/:id       - Detalhes do produto
GET /public/:slug/categorias         - Categorias dispon√≠veis
```

### 3.4 Gest√£o de Pedidos

#### Recursos Implementados
- ‚úÖ Cria√ß√£o de pedidos com itens
- ‚úÖ C√°lculo autom√°tico de totais (subtotal, desconto, frete, total)
- ‚úÖ Gest√£o de status do pedido
- ‚úÖ Hist√≥rico de mudan√ßas de status
- ‚úÖ Listagem com filtros e pagina√ß√£o
- ‚úÖ Detalhes completos do pedido
- ‚úÖ Snapshot de dados do cliente e produtos
- ‚úÖ Snapshot de endere√ßo de entrega
- ‚úÖ Integra√ß√£o com sistema de pagamento

#### Status de Pedido
- **PENDENTE:** Pedido criado, aguardando confirma√ß√£o
- **CONFIRMADO:** Pedido confirmado pela empresa
- **EM_PREPARO:** Pedido em prepara√ß√£o
- **SAIU_ENTREGA:** Pedido saiu para entrega
- **ENTREGUE:** Pedido entregue ao cliente
- **CANCELADO:** Pedido cancelado

#### Modelo Pedido
```typescript
{
  id: string
  numero: string (√∫nico)
  status: StatusPedido
  subtotal: Decimal
  desconto: Decimal
  total: Decimal
  frete: Decimal
  clienteId: string
  empresaId: string
  enderecoEntrega: string?
  formaPagamento: string?
  cupomDesconto: string?
  observacoes: string?
  itens: ItemPedido[]
}
```

#### Endpoints
```
GET    /pedidos              - Listar pedidos da empresa
POST   /pedidos              - Criar pedido
GET    /pedidos/:id          - Buscar pedido
PATCH  /pedidos/:id/status   - Atualizar status
DELETE /pedidos/:id          - Cancelar pedido
```

### 3.5 Carrinho de Compras

#### Recursos Implementados (Backend)
- ‚úÖ CRUD completo de carrinho
- ‚úÖ Adicionar/remover itens
- ‚úÖ Atualizar quantidade
- ‚úÖ Calcular totais
- ‚úÖ Limpar carrinho
- ‚úÖ Valida√ß√£o de estoque
- ‚úÖ Convers√£o de carrinho em pedido

#### Recursos Implementados (Frontend)
- ‚úÖ Context API para gerenciamento de estado global
- ‚úÖ Persist√™ncia em localStorage
- ‚úÖ CartDrawer lateral responsivo
- ‚úÖ Controle de quantidade (+/-)
- ‚úÖ Upsell/Cross-sell integrado
- ‚úÖ C√°lculo autom√°tico de subtotal

#### Endpoints
```
GET    /carrinho         - Buscar carrinho do usu√°rio
POST   /carrinho/itens   - Adicionar item
PATCH  /carrinho/itens/:id - Atualizar quantidade
DELETE /carrinho/itens/:id - Remover item
DELETE /carrinho         - Limpar carrinho
POST   /carrinho/checkout - Converter em pedido
```

### 3.6 Cupons e Descontos

#### Recursos Implementados
- ‚úÖ CRUD completo de cupons
- ‚úÖ Tipos de desconto: PERCENTUAL, VALOR_FIXO
- ‚úÖ Valor m√≠nimo de compra
- ‚úÖ Per√≠odo de validade (data in√≠cio/fim)
- ‚úÖ Controle de uso (m√°ximo de usos)
- ‚úÖ Valida√ß√£o de cupom no checkout
- ‚úÖ Aplica√ß√£o autom√°tica de desconto
- ‚úÖ Hist√≥rico de uso

#### Modelo Cupom
```typescript
{
  id: string
  codigo: string
  descricao: string?
  tipo: 'PERCENTUAL' | 'VALOR_FIXO'
  valor: Decimal
  valorMinimo: Decimal?
  dataInicio: DateTime
  dataFim: DateTime
  ativo: boolean
  usoMaximo: int?
  usoAtual: int
  empresaId: string
}
```

#### Endpoints
```
GET    /cupons              - Listar cupons da empresa
POST   /cupons              - Criar cupom
GET    /cupons/:id          - Buscar cupom
PATCH  /cupons/:id          - Atualizar cupom
DELETE /cupons/:id          - Remover cupom
POST   /cupons/validar      - Validar cupom
```

### 3.7 Pagamentos

#### Recursos Implementados
- ‚úÖ Integra√ß√£o com Asaas (gateway brasileiro)
- ‚úÖ Suporte a PIX, Cart√£o de Cr√©dito e Boleto
- ‚úÖ Gera√ß√£o de QR Code PIX
- ‚úÖ Gera√ß√£o de link de boleto
- ‚úÖ Webhook para confirma√ß√£o de pagamento
- ‚úÖ Controle de status de pagamento
- ‚úÖ Hist√≥rico de pagamentos
- ‚úÖ Pagamentos de pedidos e assinaturas

#### Status de Pagamento
- **PENDENTE:** Pagamento aguardando confirma√ß√£o
- **APROVADO:** Pagamento confirmado
- **RECUSADO:** Pagamento recusado
- **CANCELADO:** Pagamento cancelado

#### Modelo Pagamento
```typescript
{
  id: string
  empresaId: string
  assinaturaId: string?
  pedidoId: string?
  tipo: 'ASSINATURA' | 'PEDIDO'
  metodo: 'PIX' | 'CARTAO' | 'BOLETO'
  status: string
  valor: Float
  asaasPaymentId: string?
  asaasInvoiceUrl: string?
  pixQrCode: string?
  pixCopyPaste: string?
  boletoUrl: string?
  dataVencimento: DateTime?
  dataPagamento: DateTime?
}
```

#### Endpoints
```
POST   /pagamentos              - Criar pagamento
GET    /pagamentos/:id          - Buscar pagamento
GET    /pagamentos/pedido/:id   - Pagamentos do pedido
POST   /webhooks/asaas          - Webhook Asaas
```

### 3.8 Assinaturas (Planos de Empresa)

#### Recursos Implementados
- ‚úÖ Sistema de planos (BASICO, PROFISSIONAL, ENTERPRISE)
- ‚úÖ Integra√ß√£o com Stripe para pagamentos recorrentes
- ‚úÖ Controle de status (ATIVA, CANCELADA, SUSPENSA, TRIAL)
- ‚úÖ Gest√£o de ciclos de cobran√ßa
- ‚úÖ Webhook Stripe para sincroniza√ß√£o
- ‚úÖ Hist√≥rico de assinaturas
- ‚úÖ Dashboard de assinaturas (SuperAdmin)

#### Modelo Assinatura
```typescript
{
  id: string
  empresaId: string
  plano: 'BASICO' | 'PROFISSIONAL' | 'ENTERPRISE'
  status: 'ATIVA' | 'CANCELADA' | 'SUSPENSA' | 'TRIAL'
  stripeCustomerId: string?
  stripeSubscriptionId: string?
  dataInicio: DateTime
  dataFim: DateTime?
  valorMensal: Float
  proximaCobranca: DateTime?
}
```

#### Endpoints
```
GET    /assinaturas              - Listar assinaturas (SuperAdmin)
POST   /assinaturas              - Criar assinatura
GET    /assinaturas/:id          - Buscar assinatura
PATCH  /assinaturas/:id          - Atualizar assinatura
DELETE /assinaturas/:id          - Cancelar assinatura
POST   /webhooks/stripe          - Webhook Stripe
```

### 3.9 Dashboard e Relat√≥rios

#### Recursos Implementados
- ‚úÖ M√©tricas gerais (vendas, pedidos, clientes)
- ‚úÖ Gr√°fico de vendas por per√≠odo
- ‚úÖ Produtos mais vendidos
- ‚úÖ Pedidos recentes
- ‚úÖ Filtros por per√≠odo (hoje, semana, m√™s, personalizado)
- ‚úÖ C√°lculos de crescimento
- ‚úÖ Cards informativos com estat√≠sticas

#### M√©tricas Dispon√≠veis
```typescript
{
  vendasHoje: number
  vendasMes: number
  pedidosHoje: number
  pedidosMes: number
  crescimentoVendas: number
  crescimentoPedidos: number
  produtosMaisVendidos: Array
  pedidosRecentes: Array
  graficoVendas: Array
}
```

#### Endpoints
```
GET /dashboard/metricas     - M√©tricas gerais
GET /dashboard/vendas       - Vendas por per√≠odo
GET /dashboard/produtos-top - Produtos mais vendidos
```

### 3.10 Notifica√ß√µes

#### Recursos Implementados
- ‚úÖ Sistema de notifica√ß√µes em tempo real
- ‚úÖ Tipos: PEDIDO, SISTEMA, PROMOCAO
- ‚úÖ Marca√ß√£o de leitura
- ‚úÖ Listagem com pagina√ß√£o
- ‚úÖ Notifica√ß√µes no header (dropdown)
- ‚úÖ Badge de contador
- ‚úÖ Context API para gerenciamento

#### Modelo Notificacao
```typescript
{
  id: string
  titulo: string
  mensagem: string
  tipo: 'PEDIDO' | 'SISTEMA' | 'PROMOCAO'
  lida: boolean
  usuarioId: string
  pedidoId: string?
}
```

#### Endpoints
```
GET    /notificacoes           - Listar notifica√ß√µes do usu√°rio
POST   /notificacoes           - Criar notifica√ß√£o
PATCH  /notificacoes/:id/lida  - Marcar como lida
PATCH  /notificacoes/ler-todas - Marcar todas como lidas
DELETE /notificacoes/:id       - Remover notifica√ß√£o
```

### 3.11 Integra√ß√£o com WhatsApp

#### Recursos Implementados
- ‚úÖ Envio de mensagens via WhatsApp Business API
- ‚úÖ Notifica√ß√µes de pedido
- ‚úÖ Configura√ß√£o de n√∫mero e token
- ‚úÖ Hist√≥rico de mensagens
- ‚úÖ Status de entrega (enviada, entregue, lida, erro)
- ‚úÖ Template de mensagens

#### Modelo MensagemWhatsApp
```typescript
{
  id: string
  empresaId: string
  pedidoId: string?
  telefone: string
  mensagem: string
  tipo: 'NOTIFICACAO' | 'CHAT'
  direcao: 'ENVIADA' | 'RECEBIDA'
  status: 'PENDENTE' | 'ENVIADA' | 'ENTREGUE' | 'LIDA' | 'ERRO'
  whatsappId: string?
  erro: string?
}
```

#### Endpoints
```
POST /whatsapp/enviar            - Enviar mensagem
GET  /whatsapp/configuracao      - Buscar config
POST /whatsapp/configuracao      - Salvar config
GET  /whatsapp/mensagens         - Hist√≥rico
```

### 3.12 Avalia√ß√µes

#### Recursos Implementados
- ‚úÖ Sistema de avalia√ß√£o de produtos e pedidos
- ‚úÖ Notas de 1 a 5 estrelas
- ‚úÖ Coment√°rios opcionais
- ‚úÖ Listagem de avalia√ß√µes por produto
- ‚úÖ M√©dia de avalia√ß√µes
- ‚úÖ Modera√ß√£o de avalia√ß√µes

#### Modelo Avaliacao
```typescript
{
  id: string
  nota: int (1-5)
  comentario: string?
  produtoId: string
  usuarioId: string
  pedidoId: string?
}
```

#### Endpoints
```
GET    /avaliacoes                - Listar avalia√ß√µes
POST   /avaliacoes                - Criar avalia√ß√£o
GET    /avaliacoes/produto/:id    - Avalia√ß√µes do produto
DELETE /avaliacoes/:id            - Remover avalia√ß√£o
```

### 3.13 Endere√ßos

#### Recursos Implementados
- ‚úÖ CRUD de endere√ßos de usu√°rios
- ‚úÖ Valida√ß√£o de CEP
- ‚úÖ Integra√ß√£o com ViaCEP para autocompletar
- ‚úÖ Snapshot de endere√ßo em pedidos

#### Modelo Endereco
```typescript
{
  id: string
  usuarioId: string
  cep: string?
  rua: string?
  numero: string?
  complemento: string?
  bairro: string?
  cidade: string?
  uf: string?
}
```

### 3.14 Webhooks (Logging)

#### Recursos Implementados
- ‚úÖ Log de webhooks recebidos
- ‚úÖ Suporte a Stripe e Asaas
- ‚úÖ Armazenamento de payload completo
- ‚úÖ Status de processamento
- ‚úÖ Registro de erros
- ‚úÖ Filtros e busca

#### Modelo WebhookLog
```typescript
{
  id: string
  origem: 'STRIPE' | 'ASAAS'
  evento: string
  payload: Json
  processado: boolean
  erro: string?
}
```

---

## 4. FUNCIONALIDADES PLANEJADAS (N√ÉO IMPLEMENTADAS)

### 4.1 Sistema de Tickets (Suporte)

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Sistema completo de suporte ao cliente com tickets, mensagens, prioridades e status.

**Funcionalidades Planejadas:**
- Abertura de tickets por empresas
- Sistema de mensagens no ticket
- N√≠veis de prioridade (baixa, m√©dia, alta, urgente)
- Status (aberto, em andamento, resolvido, fechado)
- √Årea de suporte dedicada
- Notifica√ß√µes de novos tickets

### 4.2 Upload de Imagens para Cloud

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Integra√ß√£o com Cloudinary ou AWS S3 para upload direto de imagens de produtos.

**Funcionalidades Planejadas:**
- Upload direto via frontend
- Redimensionamento autom√°tico
- Compress√£o de imagens
- CDN para entrega otimizada
- Thumbnails autom√°ticos

**Implementa√ß√£o Atual:** URLs de imagens inseridas manualmente

### 4.3 Programa de Fidelidade

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Sistema de pontos e recompensas para clientes fi√©is.

**Funcionalidades Planejadas:**
- Ac√∫mulo de pontos por compra
- Resgate de pontos
- N√≠veis de fidelidade
- Benef√≠cios exclusivos
- Dashboard de pontos

### 4.4 Entrega com Rastreamento

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Integra√ß√£o com servi√ßos de log√≠stica para rastreamento em tempo real.

**Funcionalidades Planejadas:**
- Integra√ß√£o com Correios, Loggi, etc.
- Rastreamento em tempo real
- Notifica√ß√µes de posi√ß√£o
- Estimativa de tempo de entrega
- Hist√≥rico de rotas

### 4.5 Gest√£o de Promo√ß√µes Avan√ßadas

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Sistema avan√ßado de promo√ß√µes e campanhas de marketing.

**Funcionalidades Planejadas:**
- Promo√ß√µes por categoria
- Combos promocionais
- Compre X leve Y
- Frete gr√°tis condicional
- Desconto progressivo
- Agendamento de promo√ß√µes

### 4.6 Integra√ß√£o com Marketplaces

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Integra√ß√£o com iFood, Rappi, Uber Eats para sincroniza√ß√£o de card√°pio e pedidos.

**Funcionalidades Planejadas:**
- Sincroniza√ß√£o de produtos
- Importa√ß√£o de pedidos
- Atualiza√ß√£o de estoque
- Gest√£o unificada
- Relat√≥rios consolidados

### 4.7 Sistema de Reservas

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Para restaurantes que aceitam reservas de mesas.

**Funcionalidades Planejadas:**
- Calend√°rio de disponibilidade
- Gest√£o de mesas
- Confirma√ß√£o por email/WhatsApp
- Hist√≥rico de reservas
- Lista de espera

### 4.8 Multi-idioma (i18n)

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Suporte a m√∫ltiplos idiomas na plataforma.

**Funcionalidades Planejadas:**
- Seletor de idioma
- Tradu√ß√µes autom√°ticas
- Gest√£o de tradu√ß√µes
- Suporte a PT, EN, ES inicialmente

### 4.9 App Mobile Nativo

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Aplicativo nativo para iOS e Android.

**Tecnologias Consideradas:**
- React Native
- Flutter
- Notifica√ß√µes push
- Geolocaliza√ß√£o
- Pagamento in-app

### 4.10 An√°lise Avan√ßada (BI)

**Status:** Planejado, n√£o implementado  
**Descri√ß√£o:** Business Intelligence com relat√≥rios avan√ßados e insights.

**Funcionalidades Planejadas:**
- An√°lise de cohort
- Previs√£o de demanda
- An√°lise de abandono de carrinho
- Lifetime Value do cliente
- Relat√≥rios customiz√°veis
- Exporta√ß√£o para Excel/PDF

---

## 5. ESTRUTURA DE ARQUIVOS E HIERARQUIA

### 5.1 Backend (/backend)

```
backend/
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/                  # Hist√≥rico de migrations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 20251013124033_initial_schema/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration_lock.toml
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma               # Schema do banco de dados
‚îÇ   ‚îî‚îÄ‚îÄ seed.ts                     # Script de seed (dados iniciais)
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ migrate.sh                  # Helper para migrations
‚îÇ   ‚îî‚îÄ‚îÄ seed.sh                     # Helper para seed
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts               # M√≥dulo raiz da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ app.controller.ts           # Controller raiz (health check)
‚îÇ   ‚îú‚îÄ‚îÄ app.service.ts              # Service raiz
‚îÇ   ‚îú‚îÄ‚îÄ main.ts                     # Entry point da aplica√ß√£o
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ common/                     # Recursos compartilhados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ guards/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ (guards compartilhados)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database/                   # M√≥dulo de banco de dados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma.module.ts        # M√≥dulo global do Prisma
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prisma.service.ts       # Servi√ßo singleton do Prisma
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ decorators/                 # Decorators customizados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ current-empresa.decorator.ts  # @CurrentEmpresa()
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ current-user.decorator.ts     # @CurrentUser()
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ public.decorator.ts           # @Public()
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roles.decorator.ts            # @Roles()
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ filters/                    # Exception filters
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ all-exceptions.filter.ts  # Global exception filter
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ guards/                     # Guards de autentica√ß√£o e autoriza√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt-auth.guard.ts       # Guard JWT padr√£o
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roles.guard.ts          # Guard de roles
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middleware/                 # Middlewares
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tenant.middleware.ts    # Multi-tenancy middleware
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils/                      # Utilit√°rios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ date.helpers.ts         # Helpers de data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ response.helpers.ts     # Helpers de resposta API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.helpers.ts   # Helpers de valida√ß√£o
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                # Barrel export
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ modules/                    # M√≥dulos de funcionalidade
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/                   # Autentica√ß√£o e autoriza√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signup.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ refresh-token.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create-account-from-order.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt-payload.interface.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth-response.interface.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ strategies/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt.strategy.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ local.strategy.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.module.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ produtos/               # Gest√£o de produtos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-produto.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ update-produto.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ filtrar-produtos.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ produtos.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ produtos.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ produtos.module.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ carrinho/               # Carrinho de compras
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ add-item-carrinho.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update-item-carrinho.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ carrinho.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ carrinho.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ carrinho.module.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pagamentos/             # Gest√£o de pagamentos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-pagamento.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ asaas-webhook.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pagamentos.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pagamentos.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asaas.service.ts     # Integra√ß√£o Asaas
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pagamentos.module.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assinaturas/            # Gest√£o de assinaturas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-assinatura.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update-assinatura.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assinaturas.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assinaturas.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stripe.service.ts    # Integra√ß√£o Stripe
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ assinaturas.module.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp/               # Integra√ß√£o WhatsApp
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enviar-mensagem.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config-whatsapp.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ whatsapp.module.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhooks/               # Webhooks (Stripe, Asaas)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhooks.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhooks.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webhooks.module.ts
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ public/                 # Endpoints p√∫blicos
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ create-pedido-publico.dto.ts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ public.controller.ts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ public.service.ts
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ public.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pedidos/                    # Gest√£o de pedidos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-pedido.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ update-status-pedido.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ filtrar-pedidos.dto.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pedidos.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pedidos.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pedidos.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ cupons/                     # Gest√£o de cupons
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-cupom.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ update-cupom.dto.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validar-cupom.dto.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cupons.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cupons.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cupons.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ avaliacoes/                 # Sistema de avalia√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create-avaliacao.dto.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avaliacoes.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avaliacoes.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ avaliacoes.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ notificacoes/               # Sistema de notifica√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ create-notificacao.dto.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notificacoes.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notificacoes.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notificacoes.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/                  # Dashboard e m√©tricas
‚îÇ       ‚îú‚îÄ‚îÄ dashboard.controller.ts
‚îÇ       ‚îú‚îÄ‚îÄ dashboard.service.ts
‚îÇ       ‚îî‚îÄ‚îÄ dashboard.module.ts
‚îÇ
‚îú‚îÄ‚îÄ test/                           # Testes
‚îÇ   ‚îî‚îÄ‚îÄ (arquivos de teste)
‚îÇ
‚îú‚îÄ‚îÄ .env.example                    # Template de vari√°veis de ambiente
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ docker-compose.yml              # Redis container
‚îú‚îÄ‚îÄ nest-cli.json                   # Configura√ß√£o do NestJS CLI
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json                   # Configura√ß√£o TypeScript
‚îú‚îÄ‚îÄ README.md                       # Documenta√ß√£o do backend
‚îî‚îÄ‚îÄ SUPABASE-SETUP.md              # Guia de setup do Supabase
```

### 5.2 Frontend (/)

```
src/
‚îú‚îÄ‚îÄ main.tsx                        # Entry point da aplica√ß√£o
‚îú‚îÄ‚îÄ App.tsx                         # Componente raiz
‚îú‚îÄ‚îÄ index.css                       # Estilos globais (Tailwind)
‚îú‚îÄ‚îÄ theme.ts                        # Tokens de tema
‚îú‚îÄ‚îÄ vite-env.d.ts                   # Types do Vite
‚îÇ
‚îú‚îÄ‚îÄ auth/                           # Autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.tsx             # Context de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ types.ts                    # Tipos de roles
‚îÇ   ‚îî‚îÄ‚îÄ useRoleGuard.ts             # Hook de prote√ß√£o por role
‚îÇ
‚îú‚îÄ‚îÄ components/                     # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                    # Barrel export
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ auth/                       # Componentes de autentica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RequireAuth.tsx         # HOC de prote√ß√£o de rotas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ commerce/                   # Componentes de e-commerce
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CartDrawer.tsx          # Drawer do carrinho (lateral)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CartDrawerBackend.tsx   # Vers√£o backend integrada
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductCard.tsx         # Card de produto
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UpsellStrip.tsx         # Strip de upsell/cross-sell
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ common/                     # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Badge.tsx               # Badge de status
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx              # Bot√£o customizado
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Card.tsx                # Card container
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Container.tsx           # Container principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ErrorBoundary.tsx       # Error boundary
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Input.tsx               # Input customizado
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Loading.tsx             # Indicador de loading
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.ts                # Tipos compartilhados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/                  # Componentes de dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DateRangeFilter.tsx     # Filtro de data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SalesChart.tsx          # Gr√°fico de vendas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ layout/                     # Layouts e navega√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardShell.tsx      # Shell do dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PublicHeader.tsx        # Header p√∫blico
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StoreSidebar.tsx        # Sidebar da loja
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StoreTopbarActions.tsx  # A√ß√µes da topbar
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StorefrontHeader.tsx    # Header da vitrine
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SuperAdminSidebar.tsx   # Sidebar do super admin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Topbar.tsx              # Topbar principal
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ system/                     # Componentes de sistema
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImpersonationBanner.tsx # Banner de impersona√ß√£o
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ModalAvaliacao.tsx          # Modal de avalia√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ NotificacoesDropdown.tsx    # Dropdown de notifica√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ PagamentoPix.tsx            # Componente de pagamento PIX
‚îÇ   ‚îî‚îÄ‚îÄ README.md                   # Documenta√ß√£o de componentes
‚îÇ
‚îú‚îÄ‚îÄ contexts/                       # Context API
‚îÇ   ‚îú‚îÄ‚îÄ AssinaturaContext.tsx       # Context de assinatura
‚îÇ   ‚îú‚îÄ‚îÄ CartContext.tsx             # Context do carrinho
‚îÇ   ‚îú‚îÄ‚îÄ ClientAuthContext.tsx       # Context de auth do cliente
‚îÇ   ‚îî‚îÄ‚îÄ NotificacoesContext.tsx     # Context de notifica√ß√µes
‚îÇ
‚îú‚îÄ‚îÄ hooks/                          # Hooks customizados
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                    # Barrel export
‚îÇ   ‚îú‚îÄ‚îÄ useApi.ts                   # Hook de chamadas API
‚îÇ   ‚îú‚îÄ‚îÄ useCart.ts                  # Hook do carrinho
‚îÇ   ‚îú‚îÄ‚îÄ useDebounce.ts              # Hook de debounce
‚îÇ   ‚îú‚îÄ‚îÄ useForm.ts                  # Hook de formul√°rios
‚îÇ   ‚îú‚îÄ‚îÄ usePagination.ts            # Hook de pagina√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ README.md                   # Documenta√ß√£o de hooks
‚îÇ
‚îú‚îÄ‚îÄ layouts/                        # Layouts de p√°gina
‚îÇ   ‚îî‚îÄ‚îÄ AdminLayout.tsx             # Layout administrativo
‚îÇ
‚îú‚îÄ‚îÄ pages/                          # P√°ginas da aplica√ß√£o
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ public/                     # P√°ginas p√∫blicas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home.tsx                # Landing page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.tsx               # Login (mock)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LoginBackend.tsx        # Login (backend real)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ storefront/                 # Vitrine e checkout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Vitrine.tsx             # Listagem de produtos (mock)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VitrineBackend.tsx      # Listagem (backend real)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Checkout.tsx            # Checkout (mock)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CheckoutBackend.tsx     # Checkout (backend real)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientLogin.tsx         # Login de cliente
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OrderConfirmation.tsx   # Confirma√ß√£o (mock)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OrderConfirmationBackend.tsx # Confirma√ß√£o (backend)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ admin/                      # √Årea administrativa
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ store/                  # Admin da loja (ADMIN_EMPRESA)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx       # Dashboard da loja
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Products.tsx        # Gest√£o de produtos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductEdit.tsx     # Edi√ß√£o de produto
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Orders.tsx          # Gest√£o de pedidos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Clients.tsx         # Gest√£o de clientes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientEdit.tsx      # Edi√ß√£o de cliente
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Settings.tsx        # Configura√ß√µes da loja
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ super/                  # Admin superadmin
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx       # Dashboard superadmin
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Companies.tsx       # Gest√£o de empresas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Subscriptions.tsx   # Gest√£o de assinaturas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Tickets.tsx         # Sistema de tickets
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Settings.tsx        # Configura√ß√µes globais
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx           # Dashboard unificado
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pedidos.tsx             # Pedidos da empresa
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Cupons.tsx              # Gest√£o de cupons
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConfiguracaoWhatsApp.tsx # Configura√ß√£o WhatsApp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Webhooks.tsx            # Log de webhooks
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ assinaturas/                # Assinaturas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CheckoutAssinatura.tsx  # Checkout de assinatura
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MinhaAssinatura.tsx     # Detalhes da assinatura
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Planos.tsx              # Listagem de planos
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ cliente/                    # √Årea do cliente
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MeusPedidos.tsx         # Hist√≥rico de pedidos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MinhasAvaliacoes.tsx    # Avalia√ß√µes feitas
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pagamentos/                 # Pagamentos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DetalhesPagamento.tsx   # Detalhes de pagamento
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ HistoricoPagamentos.tsx # Hist√≥rico
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ support/                    # √Årea de suporte
‚îÇ       ‚îú‚îÄ‚îÄ Layout.tsx              # Layout de suporte
‚îÇ       ‚îî‚îÄ‚îÄ Tickets.tsx             # Sistema de tickets
‚îÇ
‚îú‚îÄ‚îÄ routes/                         # Configura√ß√£o de rotas
‚îÇ   ‚îú‚îÄ‚îÄ AppRouter.tsx               # Router principal
‚îÇ   ‚îú‚îÄ‚îÄ admin.routes.tsx            # Rotas admin
‚îÇ   ‚îú‚îÄ‚îÄ client.routes.tsx           # Rotas cliente
‚îÇ   ‚îú‚îÄ‚îÄ public.routes.tsx           # Rotas p√∫blicas
‚îÇ   ‚îú‚îÄ‚îÄ storefront.routes.tsx       # Rotas vitrine
‚îÇ   ‚îú‚îÄ‚îÄ super.routes.tsx            # Rotas superadmin
‚îÇ   ‚îú‚îÄ‚îÄ support.routes.tsx          # Rotas suporte
‚îÇ   ‚îú‚îÄ‚îÄ types.ts                    # Tipos de rotas
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # Barrel export
‚îÇ
‚îú‚îÄ‚îÄ services/                       # Servi√ßos de API
‚îÇ   ‚îú‚îÄ‚îÄ api.ts                      # API principal (mock)
‚îÇ   ‚îú‚îÄ‚îÄ api.types.ts                # Tipos de API
‚îÇ   ‚îú‚îÄ‚îÄ api.utils.ts                # Utilit√°rios de API
‚îÇ   ‚îú‚îÄ‚îÄ apiClient.ts                # Cliente Axios configurado
‚îÇ   ‚îú‚îÄ‚îÄ backendApi.ts               # API backend real
‚îÇ   ‚îú‚îÄ‚îÄ dashboardApi.ts             # API de dashboard
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # Barrel export
‚îÇ
‚îú‚îÄ‚îÄ ui/                             # UI system
‚îÇ   ‚îú‚îÄ‚îÄ feedback/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ToastContext.tsx        # Context de toast
‚îÇ   ‚îî‚îÄ‚îÄ theme/
‚îÇ       ‚îî‚îÄ‚îÄ tokens.ts               # Tokens de design
‚îÇ
‚îî‚îÄ‚îÄ utils/                          # Utilit√°rios
    ‚îú‚îÄ‚îÄ assinaturaGuards.ts         # Guards de assinatura
    ‚îú‚îÄ‚îÄ formatters.ts               # Formatadores (moeda, data)
    ‚îú‚îÄ‚îÄ safeStorage.ts              # Wrapper seguro localStorage
    ‚îî‚îÄ‚îÄ statusColors.ts             # Cores de status

# Arquivos na raiz do frontend
‚îú‚îÄ‚îÄ index.html                      # HTML principal
‚îú‚îÄ‚îÄ package.json                    # Depend√™ncias frontend
‚îú‚îÄ‚îÄ vite.config.ts                  # Configura√ß√£o Vite
‚îú‚îÄ‚îÄ tailwind.config.js              # Configura√ß√£o Tailwind
‚îú‚îÄ‚îÄ postcss.config.js               # Configura√ß√£o PostCSS
‚îú‚îÄ‚îÄ tsconfig.json                   # TypeScript config
‚îú‚îÄ‚îÄ tsconfig.app.json               # TypeScript app config
‚îú‚îÄ‚îÄ tsconfig.node.json              # TypeScript node config
‚îú‚îÄ‚îÄ eslint.config.js                # ESLint config
‚îî‚îÄ‚îÄ .gitignore
```

---

## 6. MODELOS DE DADOS (PRISMA SCHEMA)

### 6.1 Vis√£o Geral dos Modelos

O schema Prisma define 16 modelos principais que representam as entidades do sistema:

1. **Empresa** - Empresas/Lojas multi-tenant
2. **Usuario** - Usu√°rios do sistema (admins, clientes)
3. **Produto** - Produtos das lojas
4. **Pedido** - Pedidos de clientes
5. **ItemPedido** - Itens individuais dos pedidos
6. **RefreshToken** - Tokens de renova√ß√£o JWT
7. **Carrinho** - Carrinhos de compra
8. **ItemCarrinho** - Itens dos carrinhos
9. **Cupom** - Cupons de desconto
10. **Avaliacao** - Avalia√ß√µes de produtos/pedidos
11. **Notificacao** - Notifica√ß√µes de usu√°rios
12. **Assinatura** - Assinaturas de empresas
13. **Pagamento** - Pagamentos (pedidos e assinaturas)
14. **WebhookLog** - Log de webhooks recebidos
15. **MensagemWhatsApp** - Mensagens WhatsApp
16. **Endereco** - Endere√ßos de usu√°rios

### 6.2 Enums

```prisma
enum Role {
  SUPER_ADMIN      // Administrador geral do sistema
  ADMIN_EMPRESA    // Administrador de uma empresa
  CLIENTE          // Cliente final
}

enum StatusPedido {
  PENDENTE         // Pedido criado, aguardando processamento
  CONFIRMADO       // Pedido confirmado pela empresa
  EM_PREPARO       // Pedido sendo preparado
  SAIU_ENTREGA     // Pedido saiu para entrega
  ENTREGUE         // Pedido entregue
  CANCELADO        // Pedido cancelado
}
```

### 6.3 Modelos Detalhados

#### 6.3.1 Empresa
```prisma
model Empresa {
  id              String   @id @default(uuid())
  nome            String
  slug            String   @unique
  subdominio      String   @unique
  ativo           Boolean  @default(true)
  whatsappNumero  String?
  whatsappToken   String?
  asaasCustomerId String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Rela√ß√µes
  usuarios          Usuario[]
  produtos          Produto[]
  pedidos           Pedido[]
  carrinhos         Carrinho[]
  cupons            Cupom[]
  assinatura        Assinatura?
  pagamentos        Pagamento[]
  mensagensWhatsApp MensagemWhatsApp[]
}
```

**Principais Campos:**
- `slug` e `subdominio` s√£o √∫nicos para cada empresa
- `asaasCustomerId` para integra√ß√£o com gateway de pagamento
- Rela√ß√µes 1:N com a maioria das entidades do sistema

#### 6.3.2 Usuario
```prisma
model Usuario {
  id        String   @id @default(uuid())
  email     String   @unique
  senha     String   // Hash bcrypt
  nome      String
  telefone  String?
  cpf       String?
  role      Role     @default(CLIENTE)
  empresaId String?  // Null para SUPER_ADMIN
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Rela√ß√µes
  empresa      Empresa?       @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  pedidos      Pedido[]
  carrinho     Carrinho?
  avaliacoes   Avaliacao[]
  notificacoes Notificacao[]
  endereco     Endereco?

  @@index([empresaId])
}
```

**Principais Campos:**
- `role` define o n√≠vel de acesso (SUPER_ADMIN, ADMIN_EMPRESA, CLIENTE)
- `empresaId` √© null para SUPER_ADMIN (acesso multi-tenant)
- Rela√ß√£o 1:1 com Carrinho e Endereco

#### 6.3.3 Produto
```prisma
model Produto {
  id        String   @id @default(uuid())
  nome      String
  descricao String?
  preco     Decimal  @db.Decimal(10, 2)
  imagem    String?
  ativo     Boolean  @default(true)
  empresaId String
  estoque   Int      @default(0)
  categoria String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Rela√ß√µes
  empresa       Empresa        @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  itensCarrinho ItemCarrinho[]
  itensPedido   ItemPedido[]
  avaliacoes    Avaliacao[]

  @@index([empresaId])
  @@index([ativo])
  @@index([empresaId, ativo])
  @@index([empresaId, categoria])
}
```

**√çndices:**
- √çndices compostos para otimizar queries multi-tenant
- `[empresaId, ativo]` para listar produtos ativos por empresa
- `[empresaId, categoria]` para filtros por categoria

#### 6.3.4 Pedido
```prisma
model Pedido {
  id               String        @id @default(uuid())
  numero           String        @unique  // N√∫mero sequencial do pedido
  status           StatusPedido  @default(PENDENTE)
  subtotal         Decimal       @db.Decimal(10, 2)
  desconto         Decimal       @default(0) @db.Decimal(10, 2)
  total            Decimal       @db.Decimal(10, 2)
  frete            Decimal       @default(0) @db.Decimal(10, 2)
  clienteId        String
  empresaId        String
  enderecoEntrega  String?
  formaPagamento   String?
  cupomDesconto    String?
  observacoes      String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  // Rela√ß√µes
  cliente           Usuario            @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  empresa           Empresa            @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  itens             ItemPedido[]
  avaliacoes        Avaliacao[]
  notificacoes      Notificacao[]
  pagamentos        Pagamento[]
  mensagensWhatsApp MensagemWhatsApp[]

  @@index([clienteId])
  @@index([empresaId])
  @@index([status])
  @@index([empresaId, createdAt])
  @@index([empresaId, status])
  @@index([createdAt])
}
```

**C√°lculos:**
- `total = subtotal - desconto + frete`
- `subtotal` √© calculado a partir dos itens
- `desconto` aplicado via cupom

#### 6.3.5 ItemPedido
```prisma
model ItemPedido {
  id            String   @id @default(uuid())
  pedidoId      String
  produtoId     String
  quantidade    Int
  precoUnitario Decimal  @db.Decimal(10, 2)
  subtotal      Decimal  @db.Decimal(10, 2)
  observacoes   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Rela√ß√µes
  pedido  Pedido  @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produto Produto @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@index([pedidoId])
  @@index([produtoId])
  @@index([pedidoId, produtoId])
}
```

**Snapshot de Pre√ßo:**
- `precoUnitario` √© snapshot do pre√ßo no momento do pedido
- Mesmo que o produto mude de pre√ßo, o pedido mant√©m o hist√≥rico

#### 6.3.6 Carrinho e ItemCarrinho
```prisma
model Carrinho {
  id        String   @id @default(uuid())
  usuarioId String   @unique
  empresaId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  usuario Usuario        @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  empresa Empresa        @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  itens   ItemCarrinho[]

  @@index([usuarioId])
  @@index([empresaId])
}

model ItemCarrinho {
  id            String   @id @default(uuid())
  carrinhoId    String
  produtoId     String
  quantidade    Int      @default(1)
  precoUnitario Decimal  @db.Decimal(10, 2)
  observacoes   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  carrinho Carrinho @relation(fields: [carrinhoId], references: [id], onDelete: Cascade)
  produto  Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@index([carrinhoId])
  @@index([produtoId])
}
```

#### 6.3.7 Cupom
```prisma
model Cupom {
  id          String   @id @default(uuid())
  codigo      String
  descricao   String?
  tipo        String   // PERCENTUAL, VALOR_FIXO
  valor       Decimal  @db.Decimal(10, 2)
  valorMinimo Decimal? @db.Decimal(10, 2)
  dataInicio  DateTime
  dataFim     DateTime
  ativo       Boolean  @default(true)
  usoMaximo   Int?
  usoAtual    Int      @default(0)
  empresaId   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  empresa Empresa @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, codigo])
  @@index([empresaId])
  @@index([empresaId, ativo])
}
```

**Valida√ß√µes:**
- Data atual entre `dataInicio` e `dataFim`
- `usoAtual < usoMaximo` (se definido)
- Valor do pedido >= `valorMinimo` (se definido)

#### 6.3.8 Assinatura
```prisma
model Assinatura {
  id                   String    @id @default(uuid())
  empresaId            String    @unique
  plano                String    // BASICO, PROFISSIONAL, ENTERPRISE
  status               String    // ATIVA, CANCELADA, SUSPENSA, TRIAL
  stripeCustomerId     String?
  stripeSubscriptionId String?
  dataInicio           DateTime
  dataFim              DateTime?
  valorMensal          Float
  proximaCobranca      DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  empresa    Empresa     @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  pagamentos Pagamento[]

  @@index([empresaId])
  @@index([status])
}
```

#### 6.3.9 Pagamento
```prisma
model Pagamento {
  id              String       @id @default(uuid())
  empresaId       String
  assinaturaId    String?
  pedidoId        String?
  tipo            String       // ASSINATURA, PEDIDO
  metodo          String       // PIX, CARTAO, BOLETO
  status          String       // PENDENTE, APROVADO, RECUSADO, CANCELADO
  valor           Float
  asaasPaymentId  String?
  asaasInvoiceUrl String?
  pixQrCode       String?
  pixCopyPaste    String?
  boletoUrl       String?
  dataVencimento  DateTime?
  dataPagamento   DateTime?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  empresa      Empresa      @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  assinatura   Assinatura?  @relation(fields: [assinaturaId], references: [id], onDelete: SetNull)
  pedido       Pedido?      @relation(fields: [pedidoId], references: [id], onDelete: SetNull)

  @@index([empresaId])
  @@index([assinaturaId])
  @@index([pedidoId])
  @@index([status])
}
```

#### 6.3.10 Outros Modelos

**RefreshToken:**
```prisma
model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  usuarioId String
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([usuarioId])
  @@index([token])
}
```

**Avaliacao:**
```prisma
model Avaliacao {
  id         String   @id @default(uuid())
  nota       Int      // 1-5
  comentario String?
  produtoId  String
  usuarioId  String
  pedidoId   String?
  createdAt  DateTime @default(now())

  produto Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  usuario Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  pedido  Pedido?  @relation(fields: [pedidoId], references: [id], onDelete: SetNull)

  @@index([produtoId])
  @@index([usuarioId])
  @@index([pedidoId])
}
```

**Notificacao:**
```prisma
model Notificacao {
  id        String   @id @default(uuid())
  titulo    String
  mensagem  String
  tipo      String   // PEDIDO, SISTEMA, PROMOCAO
  lida      Boolean  @default(false)
  usuarioId String
  pedidoId  String?
  createdAt DateTime @default(now())

  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  pedido  Pedido? @relation(fields: [pedidoId], references: [id], onDelete: SetNull)

  @@index([usuarioId])
  @@index([pedidoId])
  @@index([usuarioId, lida])
}
```

**WebhookLog:**
```prisma
model WebhookLog {
  id         String   @id @default(uuid())
  origem     String   // STRIPE, ASAAS
  evento     String
  payload    Json
  processado Boolean  @default(false)
  erro       String?
  createdAt  DateTime @default(now())

  @@index([origem])
  @@index([processado])
}
```

**MensagemWhatsApp:**
```prisma
model MensagemWhatsApp {
  id         String   @id @default(uuid())
  empresaId  String
  pedidoId   String?
  telefone   String
  mensagem   String
  tipo       String   // NOTIFICACAO, CHAT
  direcao    String   // ENVIADA, RECEBIDA
  status     String   // PENDENTE, ENVIADA, ENTREGUE, LIDA, ERRO
  whatsappId String?
  erro       String?
  createdAt  DateTime @default(now())

  empresa Empresa @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  pedido  Pedido? @relation(fields: [pedidoId], references: [id], onDelete: SetNull)

  @@index([empresaId])
  @@index([pedidoId])
  @@index([status])
}
```

**Endereco:**
```prisma
model Endereco {
  id          String   @id @default(uuid())
  usuarioId   String   @unique
  cep         String?
  rua         String?
  numero      String?
  complemento String?
  bairro      String?
  cidade      String?
  uf          String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([usuarioId])
}
```

### 6.4 Relacionamentos Principais

```
Empresa (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Usuario
Empresa (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Produto
Empresa (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Pedido
Empresa (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Carrinho
Empresa (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Cupom
Empresa (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (1) Assinatura

Usuario (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Pedido
Usuario (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (1) Carrinho
Usuario (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (1) Endereco
Usuario (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Avaliacao
Usuario (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Notificacao

Pedido (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) ItemPedido
Pedido (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Pagamento
Pedido (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Avaliacao

Carrinho (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) ItemCarrinho

Produto (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) ItemPedido
Produto (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) ItemCarrinho
Produto (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Avaliacao

Assinatura (1) ‚îÄ‚îÄ‚îÄ‚îÄ< (N) Pagamento
```

---

## 7. ENDPOINTS DA API

### 7.1 Base URL

```
Desenvolvimento: http://localhost:3000
Produ√ß√£o: https://deliverei-backend.onrender.com
```

### 7.2 Estrutura de Resposta Padr√£o

```typescript
// Resposta de Sucesso
{
  success: true,
  data: { ... },
  message?: string
}

// Resposta de Erro
{
  success: false,
  error: {
    code: string,
    message: string,
    details?: any
  }
}
```

### 7.3 Autentica√ß√£o (P√∫blico)

#### POST /auth/login
Realizar login no sistema.

**Request:**
```json
{
  "email": "admin@pizzaexpress.com",
  "senha": "admin123"
}
```

**Response (200):**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIs...",
  "refreshToken": "550e8400-e29b-41d4-a716-446655440000",
  "user": {
    "id": "uuid",
    "email": "admin@pizzaexpress.com",
    "nome": "Admin Pizza Express",
    "role": "ADMIN_EMPRESA",
    "empresaId": "uuid"
  }
}
```

#### POST /auth/signup
Criar nova conta de usu√°rio.

**Request:**
```json
{
  "email": "novo@email.com",
  "senha": "senha123",
  "nome": "Novo Usu√°rio",
  "telefone": "11999999999",
  "empresaId": "uuid"  // Opcional para cliente
}
```

**Response (201):**
```json
{
  "accessToken": "...",
  "refreshToken": "...",
  "user": { ... }
}
```

#### POST /auth/refresh
Renovar access token usando refresh token.

**Request:**
```json
{
  "refreshToken": "550e8400-e29b-41d4-a716-446655440000"
}
```

**Response (200):**
```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIs...",
  "refreshToken": "550e8400-e29b-41d4-a716-446655440000"
}
```

#### POST /auth/logout
Realizar logout e invalidar refresh token.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Request:**
```json
{
  "refreshToken": "550e8400-e29b-41d4-a716-446655440000"
}
```

**Response (200):**
```json
{
  "message": "Logout realizado com sucesso"
}
```

#### POST /auth/create-account-from-order
Criar conta a partir de um checkout sem cadastro.

**Request:**
```json
{
  "email": "cliente@email.com",
  "nome": "Cliente Novo",
  "telefone": "11999999999",
  "pedidoId": "uuid"
}
```

### 7.4 Produtos (Autenticado)

#### GET /produtos
Listar produtos da empresa do usu√°rio autenticado.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Query Parameters:**
- `page` (number): P√°gina atual (padr√£o: 1)
- `limit` (number): Itens por p√°gina (padr√£o: 10)
- `search` (string): Busca por nome
- `categoria` (string): Filtrar por categoria
- `ativo` (boolean): Filtrar por status

**Response (200):**
```json
{
  "data": [
    {
      "id": "uuid",
      "nome": "Pizza Margherita",
      "descricao": "Molho de tomate, mussarela, manjeric√£o",
      "preco": 35.90,
      "imagem": "https://...",
      "ativo": true,
      "estoque": 50,
      "categoria": "Pizzas",
      "empresaId": "uuid",
      "createdAt": "2025-10-01T10:00:00Z"
    }
  ],
  "meta": {
    "total": 100,
    "page": 1,
    "limit": 10,
    "totalPages": 10
  }
}
```

#### POST /produtos
Criar novo produto.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Request:**
```json
{
  "nome": "Pizza Margherita",
  "descricao": "Molho de tomate, mussarela, manjeric√£o",
  "preco": 35.90,
  "imagem": "https://...",
  "estoque": 50,
  "categoria": "Pizzas"
}
```

**Response (201):**
```json
{
  "id": "uuid",
  "nome": "Pizza Margherita",
  ...
}
```

#### GET /produtos/:id
Buscar produto por ID.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Response (200):**
```json
{
  "id": "uuid",
  "nome": "Pizza Margherita",
  ...
}
```

#### PATCH /produtos/:id
Atualizar produto.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Request:**
```json
{
  "preco": 39.90,
  "estoque": 45
}
```

#### DELETE /produtos/:id
Soft delete (desativar) produto.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Response (200):**
```json
{
  "message": "Produto desativado com sucesso"
}
```

#### DELETE /produtos/:id/hard
Hard delete (remover permanentemente) - apenas SUPER_ADMIN.

**Headers:**
```
Authorization: Bearer {accessToken}
```

### 7.5 P√∫blico (Sem autentica√ß√£o)

#### GET /public/:slug/info
Informa√ß√µes da loja.

**Response (200):**
```json
{
  "id": "uuid",
  "nome": "Pizza Express",
  "slug": "pizza-express",
  "subdominio": "pizza-express",
  "ativo": true
}
```

#### GET /public/:slug/produtos
Listar produtos da loja p√∫blica.

**Query Parameters:**
- `page`, `limit`, `search`, `categoria`

**Response (200):**
```json
{
  "data": [...],
  "meta": { ... }
}
```

#### GET /public/:slug/produtos/:id
Detalhes do produto p√∫blico.

#### GET /public/:slug/categorias
Listar categorias dispon√≠veis.

**Response (200):**
```json
{
  "categorias": ["Pizzas", "Bebidas", "Sobremesas"]
}
```

### 7.6 Pedidos (Autenticado)

#### GET /pedidos
Listar pedidos da empresa.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Query Parameters:**
- `page`, `limit`
- `status` (StatusPedido): Filtrar por status
- `dataInicio`, `dataFim` (ISO date): Filtro de per√≠odo

**Response (200):**
```json
{
  "data": [
    {
      "id": "uuid",
      "numero": "001",
      "status": "CONFIRMADO",
      "total": 85.90,
      "cliente": {
        "id": "uuid",
        "nome": "Cliente",
        "email": "cliente@email.com"
      },
      "itens": [
        {
          "id": "uuid",
          "produtoId": "uuid",
          "quantidade": 2,
          "precoUnitario": 35.90,
          "subtotal": 71.80
        }
      ],
      "createdAt": "2025-10-16T14:30:00Z"
    }
  ],
  "meta": { ... }
}
```

#### POST /pedidos
Criar novo pedido.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Request:**
```json
{
  "clienteId": "uuid",
  "itens": [
    {
      "produtoId": "uuid",
      "quantidade": 2,
      "observacoes": "Sem cebola"
    }
  ],
  "enderecoEntrega": "Rua X, 123",
  "formaPagamento": "PIX",
  "cupomDesconto": "PROMO10",
  "observacoes": "Entregar no port√£o"
}
```

**Response (201):**
```json
{
  "id": "uuid",
  "numero": "002",
  "status": "PENDENTE",
  "subtotal": 71.80,
  "desconto": 7.18,
  "total": 64.62,
  "itens": [ ... ]
}
```

#### GET /pedidos/:id
Buscar pedido por ID.

#### PATCH /pedidos/:id/status
Atualizar status do pedido.

**Request:**
```json
{
  "status": "EM_PREPARO"
}
```

#### DELETE /pedidos/:id
Cancelar pedido.

### 7.7 Carrinho (Autenticado)

#### GET /carrinho
Buscar carrinho do usu√°rio.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Response (200):**
```json
{
  "id": "uuid",
  "usuarioId": "uuid",
  "empresaId": "uuid",
  "itens": [
    {
      "id": "uuid",
      "produto": {
        "id": "uuid",
        "nome": "Pizza Margherita",
        "preco": 35.90
      },
      "quantidade": 2,
      "precoUnitario": 35.90,
      "subtotal": 71.80
    }
  ],
  "totalItens": 2,
  "subtotal": 71.80
}
```

#### POST /carrinho/itens
Adicionar item ao carrinho.

**Request:**
```json
{
  "produtoId": "uuid",
  "quantidade": 2,
  "observacoes": "Sem cebola"
}
```

#### PATCH /carrinho/itens/:id
Atualizar quantidade do item.

**Request:**
```json
{
  "quantidade": 3
}
```

#### DELETE /carrinho/itens/:id
Remover item do carrinho.

#### DELETE /carrinho
Limpar carrinho.

#### POST /carrinho/checkout
Converter carrinho em pedido.

**Request:**
```json
{
  "enderecoEntrega": "Rua X, 123",
  "formaPagamento": "PIX",
  "cupomDesconto": "PROMO10",
  "observacoes": "..."
}
```

### 7.8 Cupons (Autenticado)

#### GET /cupons
Listar cupons da empresa.

**Headers:**
```
Authorization: Bearer {accessToken}
```

**Response (200):**
```json
{
  "data": [
    {
      "id": "uuid",
      "codigo": "PROMO10",
      "descricao": "10% de desconto",
      "tipo": "PERCENTUAL",
      "valor": 10,
      "valorMinimo": 50,
      "dataInicio": "2025-10-01T00:00:00Z",
      "dataFim": "2025-10-31T23:59:59Z",
      "ativo": true,
      "usoMaximo": 100,
      "usoAtual": 45
    }
  ]
}
```

#### POST /cupons
Criar cupom.

#### GET /cupons/:id
Buscar cupom.

#### PATCH /cupons/:id
Atualizar cupom.

#### DELETE /cupons/:id
Remover cupom.

#### POST /cupons/validar
Validar cupom para uso.

**Request:**
```json
{
  "codigo": "PROMO10",
  "valorPedido": 75.00
}
```

**Response (200):**
```json
{
  "valido": true,
  "cupom": { ... },
  "descontoCalculado": 7.50
}
```

### 7.9 Pagamentos (Autenticado)

#### POST /pagamentos
Criar pagamento.

**Request:**
```json
{
  "pedidoId": "uuid",
  "metodo": "PIX",
  "valor": 85.90
}
```

**Response (201):**
```json
{
  "id": "uuid",
  "status": "PENDENTE",
  "metodo": "PIX",
  "valor": 85.90,
  "pixQrCode": "data:image/png;base64,...",
  "pixCopyPaste": "00020126580014br.gov.bcb.pix..."
}
```

#### GET /pagamentos/:id
Buscar pagamento.

#### GET /pagamentos/pedido/:id
Pagamentos do pedido.

### 7.10 Assinaturas (SuperAdmin)

#### GET /assinaturas
Listar assinaturas.

**Headers:**
```
Authorization: Bearer {accessToken}
X-User-Role: SUPER_ADMIN
```

#### POST /assinaturas
Criar assinatura.

#### GET /assinaturas/:id
Buscar assinatura.

#### PATCH /assinaturas/:id
Atualizar assinatura.

#### DELETE /assinaturas/:id
Cancelar assinatura.

### 7.11 Dashboard (Autenticado)

#### GET /dashboard/metricas
M√©tricas gerais da empresa.

**Query Parameters:**
- `dataInicio`, `dataFim` (ISO date)

**Response (200):**
```json
{
  "vendasHoje": 1250.00,
  "vendasMes": 45800.00,
  "pedidosHoje": 25,
  "pedidosMes": 450,
  "crescimentoVendas": 15.5,
  "crescimentoPedidos": 12.3,
  "ticketMedio": 101.78
}
```

#### GET /dashboard/vendas
Vendas por per√≠odo para gr√°fico.

**Response (200):**
```json
{
  "vendas": [
    { "data": "2025-10-01", "valor": 1250.00 },
    { "data": "2025-10-02", "valor": 1450.00 },
    ...
  ]
}
```

#### GET /dashboard/produtos-top
Produtos mais vendidos.

**Response (200):**
```json
{
  "produtos": [
    {
      "id": "uuid",
      "nome": "Pizza Margherita",
      "quantidadeVendida": 125,
      "valorTotal": 4487.50
    },
    ...
  ]
}
```

### 7.12 Notifica√ß√µes (Autenticado)

#### GET /notificacoes
Listar notifica√ß√µes do usu√°rio.

**Query Parameters:**
- `lida` (boolean): Filtrar por lidas/n√£o lidas

**Response (200):**
```json
{
  "data": [
    {
      "id": "uuid",
      "titulo": "Novo pedido",
      "mensagem": "Pedido #001 foi realizado",
      "tipo": "PEDIDO",
      "lida": false,
      "pedidoId": "uuid",
      "createdAt": "2025-10-16T14:30:00Z"
    }
  ],
  "naoLidas": 5
}
```

#### POST /notificacoes
Criar notifica√ß√£o.

#### PATCH /notificacoes/:id/lida
Marcar como lida.

#### PATCH /notificacoes/ler-todas
Marcar todas como lidas.

#### DELETE /notificacoes/:id
Remover notifica√ß√£o.

### 7.13 WhatsApp (Autenticado)

#### POST /whatsapp/enviar
Enviar mensagem WhatsApp.

**Request:**
```json
{
  "telefone": "5511999999999",
  "mensagem": "Seu pedido #001 est√° confirmado!",
  "pedidoId": "uuid"
}
```

#### GET /whatsapp/configuracao
Buscar configura√ß√£o WhatsApp da empresa.

#### POST /whatsapp/configuracao
Salvar configura√ß√£o WhatsApp.

**Request:**
```json
{
  "whatsappNumero": "5511999999999",
  "whatsappToken": "token_da_api"
}
```

#### GET /whatsapp/mensagens
Hist√≥rico de mensagens.

### 7.14 Avalia√ß√µes (Autenticado)

#### GET /avaliacoes
Listar avalia√ß√µes.

#### POST /avaliacoes
Criar avalia√ß√£o.

**Request:**
```json
{
  "produtoId": "uuid",
  "pedidoId": "uuid",
  "nota": 5,
  "comentario": "Excelente produto!"
}
```

#### GET /avaliacoes/produto/:id
Avalia√ß√µes do produto.

#### DELETE /avaliacoes/:id
Remover avalia√ß√£o.

### 7.15 Webhooks (P√∫blico)

#### POST /webhooks/asaas
Webhook Asaas para confirma√ß√£o de pagamentos.

**Headers:**
```
asaas-access-token: {token}
```

#### POST /webhooks/stripe
Webhook Stripe para sincroniza√ß√£o de assinaturas.

**Headers:**
```
stripe-signature: {signature}
```

---

## 8. INTEGRA√á√ïES EXTERNAS

### 8.1 Supabase (PostgreSQL)

**Descri√ß√£o:** Plataforma de backend-as-a-service que fornece banco de dados PostgreSQL gerenciado.

**Uso no Projeto:**
- Banco de dados principal
- Connection pooling para melhor performance
- Backups autom√°ticos
- Dashboard de gest√£o

**Configura√ß√£o:**
```env
DATABASE_URL="postgresql://postgres.[PROJECT-REF]:[PASSWORD]@[HOST]:6543/postgres?pgbouncer=true"
```

**Recursos Utilizados:**
- PostgreSQL 15
- Connection pooling (PgBouncer)
- SSL/TLS por padr√£o

### 8.2 Render

**Descri√ß√£o:** Plataforma cloud para hospedagem de aplica√ß√µes e bancos de dados.

**Uso no Projeto:**
- Hospedagem do backend (Web Service)
- PostgreSQL gerenciado (alternativa ao Supabase)
- Deploy autom√°tico via GitHub
- SSL/TLS gratuito

**Configura√ß√£o:**
- **Web Service:** Backend Node.js
- **Build Command:** `cd backend && npm install && npx prisma generate && npm run build`
- **Start Command:** `cd backend && npm run start:prod`
- **Environment Variables:** DATABASE_URL, JWT_SECRET, etc.

### 8.3 Asaas (Gateway de Pagamento)

**Descri√ß√£o:** Gateway de pagamento brasileiro que suporta PIX, Cart√£o de Cr√©dito e Boleto.

**Uso no Projeto:**
- Processamento de pagamentos de pedidos
- Gera√ß√£o de QR Code PIX
- Gera√ß√£o de boletos
- Webhook para confirma√ß√£o de pagamento

**Endpoints Utilizados:**
- `POST /v3/payments` - Criar pagamento
- `GET /v3/payments/:id` - Consultar pagamento
- `POST /v3/customers` - Criar cliente

**Configura√ß√£o:**
```env
ASAAS_API_KEY="your_api_key"
ASAAS_API_URL="https://sandbox.asaas.com/api/v3" # ou production
```

**Webhook:**
```
POST /webhooks/asaas
```

**Eventos Suportados:**
- `PAYMENT_RECEIVED` - Pagamento confirmado
- `PAYMENT_OVERDUE` - Pagamento vencido
- `PAYMENT_DELETED` - Pagamento cancelado

### 8.4 Stripe (Pagamentos Recorrentes)

**Descri√ß√£o:** Plataforma global de pagamentos, utilizada para assinaturas recorrentes das empresas.

**Uso no Projeto:**
- Gest√£o de assinaturas (planos mensais)
- Cobran√ßa recorrente autom√°tica
- Gerenciamento de clientes (empresas)
- Webhook para sincroniza√ß√£o

**Endpoints Utilizados:**
- `POST /v1/customers` - Criar cliente
- `POST /v1/subscriptions` - Criar assinatura
- `POST /v1/subscriptions/:id` - Atualizar assinatura
- `DELETE /v1/subscriptions/:id` - Cancelar assinatura

**Configura√ß√£o:**
```env
STRIPE_SECRET_KEY="sk_test_..."
STRIPE_WEBHOOK_SECRET="whsec_..."
```

**Webhook:**
```
POST /webhooks/stripe
```

**Eventos Suportados:**
- `customer.subscription.created` - Assinatura criada
- `customer.subscription.updated` - Assinatura atualizada
- `customer.subscription.deleted` - Assinatura cancelada
- `invoice.payment_succeeded` - Pagamento bem-sucedido
- `invoice.payment_failed` - Pagamento falhou

### 8.5 WhatsApp Business API

**Descri√ß√£o:** API oficial do WhatsApp para envio de mensagens empresariais.

**Uso no Projeto:**
- Notifica√ß√µes de pedido
- Confirma√ß√µes
- Atualiza√ß√µes de status
- Suporte ao cliente

**Configura√ß√£o:**
```typescript
// Armazenado no banco por empresa
{
  whatsappNumero: "5511999999999",
  whatsappToken: "token_da_api"
}
```

**Funcionalidades:**
- Envio de mensagens de texto
- Templates pr√©-aprovados
- Rastreamento de status de entrega
- Hist√≥rico de mensagens

### 8.6 Redis

**Descri√ß√£o:** Banco de dados in-memory usado para cache e sess√µes.

**Uso no Projeto:**
- Cache de queries frequentes
- Armazenamento de sess√µes
- Rate limiting
- Cache de tokens JWT invalidados (logout)

**Configura√ß√£o (Docker):**
```yaml
# docker-compose.yml
services:
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
```

**Configura√ß√£o (App):**
```env
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=  # Opcional
```

### 8.7 ViaCEP (Integra√ß√£o Planejada)

**Descri√ß√£o:** API p√∫blica para consulta de CEP brasileiro.

**Uso no Projeto:**
- Autocompletar endere√ßo ao digitar CEP
- Valida√ß√£o de CEP

**Endpoint:**
```
GET https://viacep.com.br/ws/{cep}/json/
```

### 8.8 Cloudinary/AWS S3 (Integra√ß√£o Planejada)

**Descri√ß√£o:** Servi√ßo de armazenamento e otimiza√ß√£o de imagens.

**Uso no Projeto (Futuro):**
- Upload direto de imagens de produtos
- Redimensionamento autom√°tico
- Compress√£o
- CDN para entrega otimizada

---

## 9. SEGURAN√áA E MULTI-TENANCY

### 9.1 Arquitetura Multi-tenant

O sistema implementa **multi-tenancy isolado** onde cada empresa tem seus pr√≥prios dados completamente separados atrav√©s do `empresaId`.

#### 9.1.1 Estrat√©gias de Isolamento

**1. Database-level Isolation (Prisma)**
```typescript
// Todas as queries incluem empresaId automaticamente
await prisma.produto.findMany({
  where: {
    empresaId: currentEmpresa.id,
    ativo: true
  }
});
```

**2. Tenant Resolution (Middleware)**

O `TenantMiddleware` extrai o tenant de duas formas:

**M√©todo 1: Subdom√≠nio**
```
pizza-express.deliverei.com.br ‚Üí Empresa: Pizza Express
burger-king.deliverei.com.br   ‚Üí Empresa: Burger King
```

**M√©todo 2: Slug na URL (P√∫blico)**
```
/public/pizza-express/produtos ‚Üí Empresa: Pizza Express
/public/burger-king/produtos   ‚Üí Empresa: Burger King
```

**Implementa√ß√£o:**
```typescript
// backend/src/middleware/tenant.middleware.ts
export class TenantMiddleware implements NestMiddleware {
  async use(req: Request, res: Response, next: NextFunction) {
    const host = req.hostname;
    const subdomain = this.extractSubdomain(host);
    
    if (subdomain) {
      const empresa = await this.prisma.empresa.findUnique({
        where: { subdominio: subdomain }
      });
      req['empresa'] = empresa;
    }
    
    // Alternativa: slug na URL
    const slug = req.params.slug;
    if (slug) {
      const empresa = await this.prisma.empresa.findUnique({
        where: { slug }
      });
      req['empresa'] = empresa;
    }
    
    next();
  }
}
```

**3. Decorator @CurrentEmpresa()**
```typescript
@Get()
async listarProdutos(@CurrentEmpresa() empresa: Empresa) {
  return this.produtosService.findAll(empresa.id);
}
```

#### 9.1.2 Valida√ß√£o de Tenant

Todas as opera√ß√µes validam se o usu√°rio pertence ao tenant:

```typescript
// backend/src/utils/validation.helpers.ts
export class TenantValidator {
  static validateAccess(user: Usuario, empresaId: string): void {
    if (user.role === 'SUPER_ADMIN') {
      return; // Super admin tem acesso a tudo
    }
    
    if (user.empresaId !== empresaId) {
      throw new ForbiddenException('Acesso negado a este recurso');
    }
  }
}
```

#### 9.1.3 Corre√ß√µes de Vazamento Multi-tenant

Durante o desenvolvimento, foram identificados e corrigidos **7 vazamentos de dados**:

**Vazamentos Corrigidos:**
1. ‚úÖ Dashboard sem filtro de empresa
2. ‚úÖ Listagem de pedidos sem empresaId
3. ‚úÖ Cupons acess√≠veis entre empresas
4. ‚úÖ Notifica√ß√µes compartilhadas
5. ‚úÖ Carrinho sem valida√ß√£o de empresa
6. ‚úÖ Produtos vis√≠veis entre empresas
7. ‚úÖ Avalia√ß√µes sem isolamento

**Exemplo de Corre√ß√£o:**
```typescript
// ANTES (vulner√°vel)
async findAll() {
  return this.prisma.pedido.findMany();
}

// DEPOIS (seguro)
async findAll(empresaId: string) {
  return this.prisma.pedido.findMany({
    where: { empresaId }
  });
}
```

### 9.2 Autentica√ß√£o e Autoriza√ß√£o

#### 9.2.1 JWT (JSON Web Tokens)

**Estrat√©gia:**
- Access Token: Curta dura√ß√£o (15 minutos)
- Refresh Token: Longa dura√ß√£o (7 dias)

**Payload do JWT:**
```typescript
interface JwtPayload {
  sub: string;        // userId
  email: string;
  role: Role;
  empresaId?: string; // Null para SUPER_ADMIN
  iat: number;        // Issued at
  exp: number;        // Expiration
}
```

**Gera√ß√£o:**
```typescript
const accessToken = this.jwtService.sign(payload, {
  expiresIn: '15m'
});

const refreshToken = uuid();
await this.prisma.refreshToken.create({
  data: {
    token: refreshToken,
    usuarioId: user.id,
    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 dias
  }
});
```

#### 9.2.2 Guards

**JwtAuthGuard:**
```typescript
@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {
  canActivate(context: ExecutionContext) {
    const request = context.switchToHttp().getRequest();
    const isPublic = this.reflector.get('isPublic', context.getHandler());
    
    if (isPublic) {
      return true;
    }
    
    return super.canActivate(context);
  }
}
```

**RolesGuard:**
```typescript
@Injectable()
export class RolesGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const requiredRoles = this.reflector.get<Role[]>('roles', context.getHandler());
    
    if (!requiredRoles) {
      return true;
    }
    
    const { user } = context.switchToHttp().getRequest();
    return requiredRoles.some(role => user.role === role);
  }
}
```

**Uso:**
```typescript
@Controller('produtos')
@UseGuards(JwtAuthGuard, RolesGuard)
export class ProdutosController {
  @Get()
  @Roles('ADMIN_EMPRESA', 'SUPER_ADMIN')
  async findAll() { ... }
  
  @Post()
  @Roles('ADMIN_EMPRESA')
  async create() { ... }
}
```

#### 9.2.3 Roles e Permiss√µes

**SUPER_ADMIN:**
- Acesso total ao sistema
- Gest√£o de empresas
- Gest√£o de assinaturas
- Visualiza√ß√£o de m√©tricas globais
- Hard delete de recursos

**ADMIN_EMPRESA:**
- Acesso apenas √† pr√≥pria empresa
- Gest√£o de produtos
- Gest√£o de pedidos
- Gest√£o de clientes
- Visualiza√ß√£o de m√©tricas da empresa
- Configura√ß√µes da loja

**CLIENTE:**
- Visualiza√ß√£o de vitrine
- Gest√£o do pr√≥prio carrinho
- Cria√ß√£o de pedidos
- Hist√≥rico de pedidos
- Avalia√ß√µes

### 9.3 Prote√ß√£o de Dados Sens√≠veis

#### 9.3.1 Hash de Senhas

**Bcrypt com salt rounds = 10:**
```typescript
import * as bcrypt from 'bcrypt';

async hashPassword(senha: string): Promise<string> {
  const salt = await bcrypt.genSalt(10);
  return bcrypt.hash(senha, salt);
}

async comparePassword(senha: string, hash: string): Promise<boolean> {
  return bcrypt.compare(senha, hash);
}
```

#### 9.3.2 Sanitiza√ß√£o de Respostas

**Remove campos sens√≠veis:**
```typescript
// Nunca expor senha no retorno
const { senha, ...userWithoutPassword } = user;
return userWithoutPassword;

// Helper de resposta
export class ResponseHelpers {
  static sanitizeUser(user: Usuario) {
    const { senha, ...sanitized } = user;
    return sanitized;
  }
}
```

#### 9.3.3 Valida√ß√£o de Input

**class-validator nos DTOs:**
```typescript
export class CreateUsuarioDto {
  @IsEmail()
  email: string;
  
  @IsString()
  @MinLength(6)
  @MaxLength(100)
  senha: string;
  
  @IsString()
  @MinLength(3)
  nome: string;
  
  @IsOptional()
  @IsPhoneNumber('BR')
  telefone?: string;
}
```

### 9.4 CORS e Origem Permitida

**Configura√ß√£o:**
```typescript
// main.ts
app.enableCors({
  origin: [
    'http://localhost:5174',
    'https://deliverei-frontend.vercel.app',
    /\.deliverei\.com\.br$/  // Subdom√≠nios
  ],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],
  allowedHeaders: ['Content-Type', 'Authorization']
});
```

### 9.5 Rate Limiting (Planejado)

**Implementa√ß√£o Futura:**
```typescript
import { ThrottlerModule } from '@nestjs/throttler';

@Module({
  imports: [
    ThrottlerModule.forRoot({
      ttl: 60,        // 60 segundos
      limit: 10,      // 10 requisi√ß√µes
    }),
  ],
})
```

### 9.6 SQL Injection Prevention

**Prisma ORM:**
- Queries parametrizadas automaticamente
- Escape autom√°tico de valores
- Type-safe queries

```typescript
// SEGURO: Prisma escapa automaticamente
const produtos = await prisma.produto.findMany({
  where: {
    nome: {
      contains: userInput  // Escapado automaticamente
    }
  }
});
```

### 9.7 Logs e Auditoria

**NestJS Logger:**
```typescript
export class ProdutosService {
  private readonly logger = new Logger(ProdutosService.name);
  
  async create(data: CreateProdutoDto, empresaId: string) {
    this.logger.log(`Criando produto: ${data.nome} para empresa ${empresaId}`);
    // ...
  }
}
```

**Webhook Logging:**
```typescript
// Todos os webhooks s√£o logados
await prisma.webhookLog.create({
  data: {
    origem: 'ASAAS',
    evento: event.type,
    payload: event.data,
    processado: false
  }
});
```

---

## 10. OTIMIZA√á√ïES E PERFORMANCE

### 10.1 Backend Optimizations

#### 10.1.1 Queries Prisma Otimizadas

**Problema Eliminado: N+1 Queries**

**ANTES (N+1):**
```typescript
// 1 query para buscar pedidos
const pedidos = await prisma.pedido.findMany();

// N queries para buscar itens de cada pedido
for (const pedido of pedidos) {
  const itens = await prisma.itemPedido.findMany({
    where: { pedidoId: pedido.id }
  });
}
// Total: 1 + N queries
```

**DEPOIS (Otimizado):**
```typescript
// 1 query com include
const pedidos = await prisma.pedido.findMany({
  include: {
    itens: {
      include: {
        produto: true
      }
    },
    cliente: {
      select: {
        id: true,
        nome: true,
        email: true
      }
    }
  }
});
// Total: 1 query
```

#### 10.1.2 √çndices Compostos para Multi-tenancy

**Schema Prisma Otimizado:**
```prisma
model Produto {
  // ... campos
  
  @@index([empresaId])                  // Busca por empresa
  @@index([ativo])                      // Busca por status
  @@index([empresaId, ativo])           // Combinado
  @@index([empresaId, categoria])       // Filtro por categoria
}

model Pedido {
  // ... campos
  
  @@index([empresaId])
  @@index([status])
  @@index([empresaId, createdAt])       // Ordena√ß√£o por data
  @@index([empresaId, status])          // Dashboard filtros
  @@index([createdAt])                  // Relat√≥rios globais
}

model ItemPedido {
  // ... campos
  
  @@index([pedidoId])
  @@index([produtoId])
  @@index([pedidoId, produtoId])        // Combinado para joins
}
```

**Impacto:**
- Redu√ß√£o de 70% no tempo de queries multi-tenant
- Dashboard 5x mais r√°pido
- Listagem de pedidos 3x mais r√°pida

#### 10.1.3 Transa√ß√µes Prisma

**Opera√ß√µes At√¥micas:**
```typescript
async createPedido(data: CreatePedidoDto, empresaId: string, clienteId: string) {
  return await this.prisma.$transaction(async (tx) => {
    // 1. Criar pedido
    const pedido = await tx.pedido.create({
      data: {
        empresaId,
        clienteId,
        status: 'PENDENTE',
        subtotal: 0,
        total: 0
      }
    });
    
    // 2. Adicionar itens
    let subtotal = 0;
    for (const item of data.itens) {
      const produto = await tx.produto.findUnique({
        where: { id: item.produtoId }
      });
      
      // Verificar estoque
      if (produto.estoque < item.quantidade) {
        throw new BadRequestException('Estoque insuficiente');
      }
      
      // Criar item do pedido
      await tx.itemPedido.create({
        data: {
          pedidoId: pedido.id,
          produtoId: item.produtoId,
          quantidade: item.quantidade,
          precoUnitario: produto.preco,
          subtotal: produto.preco.mul(item.quantidade)
        }
      });
      
      // Decrementar estoque
      await tx.produto.update({
        where: { id: item.produtoId },
        data: {
          estoque: {
            decrement: item.quantidade
          }
        }
      });
      
      subtotal += produto.preco.toNumber() * item.quantidade;
    }
    
    // 3. Atualizar total do pedido
    const total = subtotal - (data.desconto || 0) + (data.frete || 0);
    
    return await tx.pedido.update({
      where: { id: pedido.id },
      data: {
        subtotal,
        desconto: data.desconto || 0,
        frete: data.frete || 0,
        total
      },
      include: {
        itens: true
      }
    });
  });
}
```

**Benef√≠cios:**
- Atomicidade: Tudo ou nada
- Consist√™ncia de dados
- Rollback autom√°tico em caso de erro
- Preven√ß√£o de race conditions

#### 10.1.4 Respostas API Padronizadas

**Helper Functions:**
```typescript
// backend/src/utils/response.helpers.ts
export class ResponseHelpers {
  static success<T>(data: T, message?: string) {
    return {
      success: true,
      data,
      ...(message && { message })
    };
  }
  
  static error(message: string, code?: string, details?: any) {
    return {
      success: false,
      error: {
        code: code || 'UNKNOWN_ERROR',
        message,
        ...(details && { details })
      }
    };
  }
  
  static paginated<T>(data: T[], meta: PaginationMeta) {
    return {
      success: true,
      data,
      meta: {
        total: meta.total,
        page: meta.page,
        limit: meta.limit,
        totalPages: Math.ceil(meta.total / meta.limit)
      }
    };
  }
}
```

**Uso:**
```typescript
@Get()
async findAll(@Query() query: FiltrarProdutosDto, @CurrentEmpresa() empresa: Empresa) {
  const { data, total } = await this.produtosService.findAll(empresa.id, query);
  
  return ResponseHelpers.paginated(data, {
    total,
    page: query.page || 1,
    limit: query.limit || 10
  });
}
```

#### 10.1.5 Error Handling Centralizado

**All Exceptions Filter:**
```typescript
// backend/src/filters/all-exceptions.filter.ts
@Catch()
export class AllExceptionsFilter implements ExceptionFilter {
  catch(exception: unknown, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();
    const request = ctx.getRequest<Request>();
    
    let status = HttpStatus.INTERNAL_SERVER_ERROR;
    let message = 'Internal server error';
    let code = 'INTERNAL_ERROR';
    
    if (exception instanceof HttpException) {
      status = exception.getStatus();
      message = exception.message;
    } else if (exception instanceof Prisma.PrismaClientKnownRequestError) {
      ({ status, message, code } = this.handlePrismaError(exception));
    }
    
    response.status(status).json({
      success: false,
      error: {
        code,
        message,
        timestamp: new Date().toISOString(),
        path: request.url
      }
    });
  }
  
  private handlePrismaError(error: Prisma.PrismaClientKnownRequestError) {
    switch (error.code) {
      case 'P2002':
        return {
          status: HttpStatus.CONFLICT,
          message: 'Registro duplicado',
          code: 'DUPLICATE_ERROR'
        };
      case 'P2025':
        return {
          status: HttpStatus.NOT_FOUND,
          message: 'Registro n√£o encontrado',
          code: 'NOT_FOUND'
        };
      default:
        return {
          status: HttpStatus.BAD_REQUEST,
          message: 'Erro de valida√ß√£o',
          code: 'VALIDATION_ERROR'
        };
    }
  }
}
```

### 10.2 Frontend Optimizations (PR #35)

#### 10.2.1 Code Splitting com Lazy Loading

**Implementa√ß√£o:**
```typescript
// src/routes/AppRouter.tsx
import { lazy, Suspense } from 'react';
import { Loading } from '@/components/common';

// Lazy load de rotas
const Dashboard = lazy(() => import('@/pages/admin/Dashboard'));
const Products = lazy(() => import('@/pages/admin/store/Products'));
const Vitrine = lazy(() => import('@/pages/storefront/VitrineBackend'));

export function AppRouter() {
  return (
    <Suspense fallback={<Loading />}>
      <Routes>
        <Route path="/admin/dashboard" element={<Dashboard />} />
        <Route path="/admin/products" element={<Products />} />
        <Route path="/loja/:slug" element={<Vitrine />} />
      </Routes>
    </Suspense>
  );
}
```

**Impacto:**
- Bundle inicial: 850KB ‚Üí 520KB (-39%)
- First Contentful Paint: -2.5s
- Time to Interactive: -3.1s

#### 10.2.2 Chunking de Vendors

**vite.config.ts:**
```typescript
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'date-vendor': ['date-fns'],
          'chart-vendor': ['recharts']
        }
      }
    },
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  }
});
```

**Benef√≠cios:**
- Melhor caching (vendors mudam raramente)
- Carregamentos subsequentes 5x mais r√°pidos
- Redu√ß√£o de re-downloads

#### 10.2.3 Context Optimization

**ANTES (re-renders desnecess√°rios):**
```typescript
export function CartContext({ children }) {
  const [items, setItems] = useState([]);
  
  const value = {
    items,
    addItem,
    removeItem
    // Novo objeto a cada render!
  };
  
  return <Context.Provider value={value}>{children}</Context.Provider>;
}
```

**DEPOIS (otimizado):**
```typescript
export function CartContext({ children }) {
  const [items, setItems] = useState([]);
  
  // Memoizar callbacks
  const addItem = useCallback((item) => {
    setItems(prev => [...prev, item]);
  }, []);
  
  const removeItem = useCallback((id) => {
    setItems(prev => prev.filter(item => item.id !== id));
  }, []);
  
  // Memoizar valores computados
  const total = useMemo(() => {
    return items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  }, [items]);
  
  // Memoizar value object
  const value = useMemo(() => ({
    items,
    total,
    addItem,
    removeItem
  }), [items, total, addItem, removeItem]);
  
  return <Context.Provider value={value}>{children}</Context.Provider>;
}
```

**Impacto:**
- 70% menos re-renders
- Componentes filhos re-renderizam apenas quando necess√°rio

#### 10.2.4 Error Boundary

**Implementa√ß√£o:**
```typescript
// src/components/common/ErrorBoundary.tsx
export class ErrorBoundary extends Component<Props, State> {
  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
    // Enviar para Sentry/LogRocket
  }
  
  render() {
    if (this.state.hasError) {
      return (
        <div className="error-fallback">
          <h1>Oops! Algo deu errado</h1>
          <button onClick={this.handleReset}>Tentar novamente</button>
        </div>
      );
    }
    
    return this.props.children;
  }
}
```

**Uso:**
```typescript
// src/App.tsx
<ErrorBoundary>
  <Suspense fallback={<Loading />}>
    <AppRouter />
  </Suspense>
</ErrorBoundary>
```

#### 10.2.5 API Client Otimizado

**Interceptors e Timeout:**
```typescript
// src/services/apiClient.ts
const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_URL,
  timeout: 30000,  // 30 segundos
  headers: {
    'Content-Type': 'application/json'
  }
});

// Request interceptor (adicionar token)
apiClient.interceptors.request.use(
  (config) => {
    const token = safeStorage.get('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor (tratamento de erros)
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Token expirado, tentar refresh
      const refreshToken = safeStorage.get('refreshToken');
      if (refreshToken) {
        try {
          const { data } = await axios.post('/auth/refresh', { refreshToken });
          safeStorage.set('token', data.accessToken);
          // Retry original request
          return apiClient(error.config);
        } catch (refreshError) {
          // Refresh falhou, fazer logout
          safeStorage.clear();
          window.location.href = '/login';
        }
      }
    }
    return Promise.reject(error);
  }
);
```

### 10.3 Database Optimizations

#### 10.3.1 Connection Pooling

**Supabase com PgBouncer:**
```
DATABASE_URL="postgresql://...?pgbouncer=true"
```

**Configura√ß√£o Prisma:**
```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
```

**Pooling Settings:**
- Pool mode: Transaction
- Default pool size: 20
- Max client connections: 100

#### 10.3.2 Query Optimization Examples

**Dashboard Vendas (Otimizado):**
```typescript
// Agrega√ß√£o eficiente com Prisma
const vendas = await prisma.pedido.groupBy({
  by: ['createdAt'],
  where: {
    empresaId,
    createdAt: {
      gte: dataInicio,
      lte: dataFim
    },
    status: {
      notIn: ['CANCELADO']
    }
  },
  _sum: {
    total: true
  },
  _count: {
    id: true
  },
  orderBy: {
    createdAt: 'asc'
  }
});
```

**Produtos Mais Vendidos:**
```typescript
const produtosTop = await prisma.itemPedido.groupBy({
  by: ['produtoId'],
  where: {
    pedido: {
      empresaId,
      status: 'ENTREGUE',
      createdAt: {
        gte: dataInicio
      }
    }
  },
  _sum: {
    quantidade: true,
    subtotal: true
  },
  orderBy: {
    _sum: {
      quantidade: 'desc'
    }
  },
  take: 10
});

// Buscar detalhes dos produtos (1 query)
const produtoIds = produtosTop.map(p => p.produtoId);
const produtos = await prisma.produto.findMany({
  where: {
    id: { in: produtoIds }
  },
  select: {
    id: true,
    nome: true,
    imagem: true,
    categoria: true
  }
});
```

### 10.4 Performance Metrics

#### 10.4.1 Backend Performance

**Antes das Otimiza√ß√µes:**
- Tempo m√©dio de resposta: ~800ms
- Queries por request: 15-20 (N+1)
- Dashboard load time: 3.5s

**Depois das Otimiza√ß√µes:**
- Tempo m√©dio de resposta: ~200ms (-75%)
- Queries por request: 2-3 (includes)
- Dashboard load time: 0.8s (-77%)

#### 10.4.2 Frontend Performance

**Antes (PR #33):**
- Initial bundle: 850 KB
- First Contentful Paint: 4.2s
- Time to Interactive: 5.8s
- Lighthouse Score: 65/100

**Depois (PR #35):**
- Initial bundle: 520 KB (-39%)
- First Contentful Paint: 1.7s (-60%)
- Time to Interactive: 2.7s (-53%)
- Lighthouse Score: 92/100

### 10.5 Monitoring e Observabilidade (Planejado)

**Ferramentas Recomendadas:**
- **Sentry:** Error tracking
- **LogRocket:** Session replay
- **New Relic / Datadog:** APM
- **Prometheus + Grafana:** M√©tricas

**M√©tricas a Monitorar:**
- Response time por endpoint
- Taxa de erro (4xx, 5xx)
- Throughput (req/s)
- Database query time
- Memory usage
- CPU usage

---

## üìö REFER√äNCIAS E DOCUMENTA√á√ÉO

### Documentos do Projeto
- `README.md` - Guia principal do projeto
- `backend/README.md` - Documenta√ß√£o do backend
- `backend/SUPABASE-SETUP.md` - Guia de setup Supabase
- `OPTIMIZATIONS.md` - Detalhes de otimiza√ß√µes PR #35
- `FASE-2-PLANEJAMENTO.md` - Planejamento Fase 2
- `RELATORIO_FINAL_PROJETO.md` - Estado final do projeto
- `ACTION_PLAN.md` - Plano de a√ß√£o e tarefas

### Documenta√ß√£o Externa
- [NestJS Documentation](https://docs.nestjs.com)
- [Prisma Documentation](https://www.prisma.io/docs)
- [React Documentation](https://react.dev)
- [Supabase Documentation](https://supabase.com/docs)

---

## üìä STATUS DO PROJETO

**√öltimo Update:** 16 de outubro de 2025, 18:15 UTC

### ‚úÖ Completado
- [x] Fase 1: Funda√ß√£o (Auth, Produtos, Multi-tenancy)
- [x] Fase 2: Features Core (Pedidos, Carrinho, Pagamentos)
- [x] Fase 3: Features Avan√ßadas (Cupons, Notifica√ß√µes, Dashboard)
- [x] Fase 4: Integra√ß√µes (WhatsApp, Asaas, Stripe)
- [x] Refatora√ß√£o Backend (Performance, Seguran√ßa)
- [x] Refatora√ß√£o Frontend Parte 1 (Organiza√ß√£o, Hooks)
- [x] Refatora√ß√£o Frontend Parte 2 (Otimiza√ß√µes) - PR #35

### üöÄ Deploy
- Backend: Render.com
- Frontend: Vercel (planejado)
- Database: Supabase PostgreSQL

### üìà Pr√≥ximos Passos
1. Merge PR #35 (aguardando aprova√ß√£o)
2. Deploy frontend para produ√ß√£o
3. Implementar monitoramento (Sentry)
4. Adicionar testes automatizados
5. Implementar sistema de tickets
6. Upload de imagens (Cloudinary)
7. App mobile (React Native)

---

**FIM DO DOCUMENTO**

Este documento foi compilado automaticamente a partir da an√°lise completa do c√≥digo-fonte, documenta√ß√£o existente e hist√≥rico do projeto DELIVEREI v1.

